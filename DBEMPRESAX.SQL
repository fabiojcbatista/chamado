
use dbempresax;
DROP TABLE USUARIO;
DROP TABLE CHAMADO;
DROP TABLE ATENDIMENTO;
DROP TABLE USUARIOS;
create database dbempresax;
use dbempresax;
CREATE TABLE IF NOT EXISTS USUARIO( 
         IDUSUARIO INT AUTO_INCREMENT,
	 NOMEUSUARIO VARCHAR(50), 
	 LOGINUSUARIO VARCHAR(50), 
	 SENHAUSUARIO VARCHAR(8), 
	 NIVELUSUARIO INT,
	 PRIMARY KEY(IDUSUARIO) 
);


INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('ADM','ADM','123',1);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('ADM','ADMA','123',2);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('Fabio','fc','2010',2);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('Fabio Batista','fcbatista','2011',2);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('Fabio Jr','fcjr','2012',2);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('Araujo','ajo','200',2);
INSERT INTO USUARIO(NOMEUSUARIO,LOGINUSUARIO,SENHAUSUARIO,NIVELUSUARIO) VALUES('Pedro','pdro','300',2);
INSERT INTO CHAMADO ( idusuario , DESCRICAOCHAMADO, PRIORIDADECHAMADO,STATUSCHAMADO) VALUES (3,'Fechando um chamado','ALTA','Fechado')


SELECT * FROM USUARIO;
-- --------------------------------------------------------------------------
USE dbempresax;
CREATE TABLE IF NOT EXISTS CHAMADO(
    IDCHAMADO INT AUTO_INCREMENT,
	idusuario int,
    DATAINICHAMADO timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
    DESCRICAOCHAMADO VARCHAR(500),
    PRIORIDADECHAMADO VARCHAR(20),
    STATUSCHAMADO VARCHAR(10),
    DATAFIMCHAMADO DATETIME,
    PRIMARY KEY(IDCHAMADO),
constraint fk_usuario foreign key(idusuario) references usuario(idusuario));

INSERT INTO CHAMADO ( idusuario , DESCRICAOCHAMADO, PRIORIDADECHAMADO,STATUSCHAMADO) VALUES (1,'CRIAR CHAMADO','ALTA','ABERTO');

-- ---------------------------------------------------------------------------------------------


CREATE TABLE IF NOT EXISTS ATENDIMENTO(
    IDATENDIMENTO INT AUTO_INCREMENT,
    IDUSUARIO INT,
    IDCHAMADO INT,
    ACAOATENDIMENTO VARCHAR(100),
    DATAATENDIMENTO timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
	COMENTARIOATENDIMENTO VARCHAR(500),
	responsavelatendimento int,
    PRIMARY KEY(IDATENDIMENTO),
    CONSTRAINT FK_USUARIO FOREIGN KEY(IDUSUARIO) REFERENCES USUARIO(IDUSUARIO), 
    CONSTRAINT FK_CHAMADO FOREIGN KEY(IDCHAMADO) REFERENCES CHAMADO(IDCHAMADO));

INSERT INTO ATENDIMENTO (IDUSUARIO,IDCHAMADO,ACAOATENDIMENTO,COMENTARIOATENDIMENTO) VALUES (1,1,'ABRIU CHAMADO','OK');
INSERT INTO ATENDIMENTO (IDUSUARIO,IDCHAMADO,ACAOATENDIMENTO,COMENTARIOATENDIMENTO) VALUES (1,1,'TRANSFERIU PARA ADM2','OK');
INSERT INTO ATENDIMENTO (IDUSUARIO,IDCHAMADO,ACAOATENDIMENTO,COMENTARIOATENDIMENTO) VALUES (1,1,'RETORNOU','OK');
INSERT INTO ATENDIMENTO (IDUSUARIO,IDCHAMADO,ACAOATENDIMENTO,COMENTARIOATENDIMENTO) VALUES (1,1,'TRANSFERIU PARA ADM2','OK');
INSERT INTO ATENDIMENTO (IDUSUARIO,IDCHAMADO,ACAOATENDIMENTO,COMENTARIOATENDIMENTO) VALUES (1,1,'FECHOU O CHAMADO','OK');

SELECT C.IDCHAMADO AS 'CHAMADO',A.ACAOATENDIMENTO AS 'AC√ÉO', U.NOMEUSUARIO AS 'USUARIO', C.DATAINICHAMADO AS 'DATA ABERTURA', C.STATUSCHAMADO AS 'STATUS', C.PRIORIDADECHAMADO AS 'PRIORIDADE', C.DATAFIMCHAMADO AS 'DATA FECHAMENTO' FROM chamado C INNER JOIN atendimento A ON C.IDCHAMADO=A.IDCHAMADO INNER JOIN usuario U ON A.IDUSUARIO=U.IDUSUARIO

-- ------------------------------------------------------------------------------------------





-- --------------------------------------------------------

--
-- Estrutura da tabela `usuario`
--

DROP TABLE IF EXISTS `usuario`;
CREATE TABLE IF NOT EXISTS `usuario` (
  `IDUSUARIO` int(11) NOT NULL AUTO_INCREMENT,
  `NOMEUSUARIO` varchar(50) DEFAULT NULL,
  `LOGINUSUARIO` varchar(50) DEFAULT NULL,
  `SENHAUSUARIO` varchar(8) DEFAULT NULL,
  PRIMARY KEY (`IDUSUARIO`)
) ENGINE=MyISAM AUTO_INCREMENT=8 DEFAULT CHARSET=latin1;

--
-- Extraindo dados da tabela `usuario`
--

INSERT INTO `usuario` (`IDUSUARIO`, `NOMEUSUARIO`, `LOGINUSUARIO`, `SENHAUSUARIO`) VALUES
(1, 'ADM', 'ADM', '123'),
(2, 'ADM', 'ADMA', '123'),
(3, 'FABIO', 'FCBATISTA', '2010'),
(4, 'FABIO', 'FCBATISTA1', '123'),
(5, 'Fabio', 'FCBATISTA2', '123'),
(6, 'Araujo', 'ajo', '321'),
(7, 'Pedro', 'pdro', '1212');
COMMIT;